<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Encomendas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    h2 { text-align: center; }
    form, .encomendas, .clientes { background: #fff; padding: 20px; margin: 20px auto; border-radius: 10px; max-width: 600px; box-shadow: 0 0 10px #ccc; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, button { width: 100%; padding: 8px; margin-top: 5px; }
    .lista-encomendas { margin-top: 20px; }
    .item-encomenda { padding: 10px; border-bottom: 1px solid #ccc; }
    .status-select { margin-top: 5px; }
  </style>
</head>
<body>
  <h2>ðŸ“¦ Registro de Encomendas</h2>

  <form id="form-encomenda">
    <label>Nome do Cliente</label>
    <input type="text" name="cliente" required>
    
    <label>Produto</label>
    <input type="text" name="produto" required>

    <label>Data de Entrega</label>
    <input type="date" name="dataEntrega" required>

    <label>Valor</label>
    <input type="number" step="0.01" name="valor" required>

    <button type="submit">Registrar Encomenda</button>
  </form>

  <form id="form-cliente">
    <h3>Cadastro de Cliente</h3>
    <label>Nome</label>
    <input type="text" name="nome" required>
    <label>Telefone</label>
    <input type="text" name="telefone" required>
    <label>EndereÃ§o</label>
    <input type="text" name="endereco">
    <button type="submit">Cadastrar Cliente</button>
  </form>

  <div class="encomendas">
    <h3>ðŸ“‹ Encomendas Registradas</h3>
    <div id="listaEncomendas" class="lista-encomendas"></div>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbw6TJuQbpbRSrMvP4ozIjgccRA6u1F_cRTcatykPH5Z0o3LTddAepE_NmrVmhiK4BpD/exec';

    // Enviar encomenda
    document.getElementById('form-encomenda').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      formData.append("tipo", "encomenda");

      await fetch(scriptURL, {
        method: 'POST',
        body: new URLSearchParams(formData)
      });

      alert("Encomenda registrada!");
      e.target.reset();
      carregarEncomendas();
    });

    // Enviar cliente
    document.getElementById('form-cliente').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      formData.append("tipo", "cliente");

      await fetch(scriptURL, {
        method: 'POST',
        body: new URLSearchParams(formData)
      });

      alert("Cliente cadastrado!");
      e.target.reset();
    });

    async function carregarEncomendas() {
      const res = await fetch(scriptURL + '?tipo=listaEncomendas');
      const dados = await res.json();
      const container = document.getElementById('listaEncomendas');
      container.innerHTML = '';

      dados.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'item-encomenda';
        div.innerHTML = `
          <strong>${item.cliente}</strong><br>
          Produto: ${item.produto}<br>
          Entrega: ${item.dataEntrega}<br>
          Valor: R$ ${item.valor}<br>
          Status: 
          <select class="status-select" data-index="${index}">
            <option ${item.status === 'AGENDADA' ? 'selected' : ''}>AGENDADA</option>
            <option ${item.status === 'ENTREGUE' ? 'selected' : ''}>ENTREGUE</option>
            <option ${item.status === 'CANCELADA' ? 'selected' : ''}>CANCELADA</option>
          </select>
        `;
        container.appendChild(div);
      });

      document.querySelectorAll('.status-select').forEach(select => {
        select.addEventListener('change', async function() {
          const index = this.dataset.index;
          const novoStatus = this.value;

          await fetch(scriptURL, {
            method: 'POST',
            body: new URLSearchParams({ tipo: 'atualizarStatus', index, status: novoStatus })
          });

          alert("Status atualizado.");
        });
      });
    }

    carregarEncomendas();
  </script>
</body>
</html>
